<% template = File.join(Rails.root, 'app/views/social_networking/shared/_sharing_fields.html') %>
<% js_helper = Class.new.extend(ActionView::Helpers::JavaScriptHelper) %>
<% if File.exist?(template) %>
  <% file = js_helper.j(Erubis::Eruby.new(File.read(template)).result) %>
<% else %>
  <% file = "" %>
  console.warn('Warning, app/views/social_networking/shared/_sharing_fields.html is not defined in host app and sharing is not possible.');
<% end %>

;(function() {
  function addSharingToNewShareableForm() {
    'use strict';

    var actionType,
        displayName,
        itemType,
        placeholder, 
        template;

    placeholder = $('.new-shareable-form-after-form-groups');
    actionType = placeholder.data('actionType');
    itemType = placeholder.data('itemType');
    template = '<%= file %>';
    displayName = itemType;
    if (displayName) {
      displayName = displayName.replace('_', ' ');
    }
    template = template.replace(/{{ ITEM_TYPE }}/g, itemType).replace(/{{ ITEM_TYPE_DISPLAY }}/g, displayName).replace(/{{ ACTION_TYPE }}/g, actionType);

    placeholder.append(template);
  };

  $(document).on('page:change', addSharingToNewShareableForm);
})();

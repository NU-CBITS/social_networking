<div ng-controller="HomeCtrl as home" ng-cloak>
  <div class="row hidden-xs hidden-sm">
    <div ng-controller="ProfilesCtrl as profiles">
      <div ng-repeat="profile in profiles.members">
        <div ng-if="!profile.isWoz" class="col-xs-12 col-md-4 text-center">
          <div class="profile-border profile-icon-top">
            <p>
              <a href="<%= profile_path %>/{{ profile.id }}" data-no-turbolink="true">
                <div><img ng-src="{{ profile.iconSrc }}"></div>
                <div>{{ profile.username }}</div>
              </a>
            </p>
          </div>

          <div class="profile-border profile-last-seen">
            <p>Last seen: {{ profile.latestAction | timeFromNow }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <ul class="list-group profile-icon-top" ng-show="home.inFeedBrowseMode()">
    <li class="list-group-item">
      <button class="btn-link faded" ng-click="home.newOnYourMindStatement()">What's on your mind?</button>
    </li>
  </ul>
  <form novalidate role="form" name="onYourMindForm" class="row" ng-show="home.inOnYourMindEntryMode()">
    <div class="form-group col-lg-8 col-md-8">
      <label for="new-on-your-mind-description">What's on your mind?</label>
      <input type="text" class="form-control" id="new-on-your-mind-description" ng-model="home.onYourMindModel.description" ng-maxlength="255" required focus-on="new-goal">
    </div>

    <div class="form-group col-lg-8 col-md-8">
      <button class="btn btn-primary" ng-click="home.saveOnYourMind()" ng-disabled="onYourMindForm.$invalid">Save</button>
      <button class="btn btn-default" ng-click="home.cancelOnYourMindEntryMode()">Cancel</button>
    </div>
  </form>

  <div class="panel panel-default" ng-show="home.inFeedBrowseMode()">
    <div class="panel-heading"><h3 class="panel-title">To Do</h3></div>
    <ul class="list-group" ng-if="home.inFeedBrowseMode()">
      <li class="list-group-item" ng-repeat="item in home.actionItems">
        <a data-no-turbolink="true" ng-click="home.taskVisited(item)" href="{{ item.link }}">{{ item.label }}</a>
      </li>
    </ul>
  </div>

  <div class="alert alert-info" role="alert" ng-if="home.actionItems.length === 0">
    You are all caught up! Great work!
  </div>

  <ul class="list-group"
      id="infinite-feed"
      infinite-scroll="home.getMore()"
      infinite-scroll-immediate-check="true"
      infinite-scroll-disabled="false">
    <li ng-repeat="item in home.feedItems"
        ng-show="home.inFeedBrowseMode()"
        class="list-group-item"
        id="{{ item.className }}-{{ item.id }}">
      <p>
        <div class="feed-item-displayname" ng-if="!item.data.summary.length">
          <img width="40px" ng-if="item.isAdmin" src="{{ home.profileIconSrcFor(item) }}">
          <strong>{{ home.profileDisplayNameFor(item) }}</strong> {{ item.summary }}
        </div>
        <div class="feed-item-displayname" ng-if="item.data.summary.length">
        <img width="40px" ng-if="item.isAdmin" src="{{ home.profileIconSrcFor(item) }}">
          <strong>{{ home.profileDisplayNameFor(item) }}</strong> {{ item.data.summary }}
        </div>

      </p>

      <div class="actions">
        <a ng-if="home.canAddLikeTo(item)" class="feed_action_btn like" title="like this item" ng-click="home.addLikeTo(item)">
          Like ({{!!item.likes.length ? item.likes.length : 0}})
        </a>
        <a ng-if="!home.canAddLikeTo(item)&&!!item.likes.length" class="feed_action_btn likes"  title="show who likes this feed item" ng-click="item.showLikes = !item.showLikes">
          Like ({{item.likes.length}})
        </a>
        <span class="pipespace" ng-if="home.canAddLikeTo(item) || !!item.likes.length"> | </span>
        <a class="feed_action_btn comments" title="view comments" ng-click="item.showComments = !item.showComments">
          Comment ({{ item.comments.length ? item.comments.length : 0}})
        </a>
        <span class="pipespace" ng-if="home.hasSummary(item)"> | </span>
        <a class="feed_action_btn" ng-if="home.hasSummary(item)" title="view details" ng-click="item.showSummary = !item.showSummary">
          <span ng-if="!item.showSummary">More</span>
          <span ng-if="!!item.showSummary">Less</span>
        </a>
        <!--
        <button class="btn btn-link" ng-if="home.canHide(item)" title="hide this feed item from others" ng-click="home.hideSharedItem(item)">
          <i class="fa fa-remove fa-2x"></i>
        </button>
        -->
      </div>
      <div class="post_extra_info">
        <div ng-if="home.hasSummary(item)" ng-show="!!item.showSummary" ng-include src="item.templatePath + '/_summary.html'"></div>

        <p ng-show="!!item.showLikes">
          Liked by: <span ng-repeat="like in item.likes">{{ like.participantDisplayName }} </span>
        </p>

        <p ng-show="!!item.showComments" class="comment text-muted" ng-repeat="comment in item.comments"><img width="40px;" ng-if="comment.isAdmin" ng-src="{{ home.profileIconSrcFor(comment) }}"> <strong>{{ home.profileDisplayNameFor(comment) }}</strong>: <span class="text-info">{{ comment.text }}</span></p>

        <a ng-show="!!item.showComments" class="feed_action_btn" ng-click="home.commentOn(item)">
          Add Comment
        </a>

      <form novalidate role="form" ng-show="home.isCommentingOn(item)">
        <div class="form-group">
          <label for="comment-text">What do you think?</label>
          <input type="text" class="form-control" id="comment-text" ng-model="home.commentModel.text" ng-maxlength="255" required focus-on="new-comment">
        </div>

        <div class="form-group">
          <button class="btn btn-primary" ng-click="home.saveComment()" ng-disabled="commentOnForm.$invalid">Save</button>
          <button class="btn btn-default" ng-click="home.closeCommentForm()">Cancel</button>
        </div>
      </form>
      </div>
    </li>
  </ul>

  <div ng-repeat="profile in home.memberProfiles">
    <div profile-status></div>
  </div>
</div>

<!-- bootstrap Angular app with data -->
<script>
  angular.module('socialNetworking.values')
    .value('participantId', <%= current_participant.id %>)
    .value('actionItems', <%= action_items.to_json.html_safe %>)
    .value('feedItems', <%= feed_items.to_json.html_safe %>)
    .value('memberProfiles', <%= member_profiles.to_json.html_safe %>)
    .value('noticesEnabled', <%= Rails.configuration.enable_notices %>)
    .value('noticeUtility', Notice);
</script>

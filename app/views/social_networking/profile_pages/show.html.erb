<%= render "social_networking/shared/nav" %>

<div ng-controller="ProfileCtrl as profile">

  <div profile-status></div>

  <a href="" ng-click="profile.nudge()">Nudge</a>
  <a href="" ng-click="profile.edit()">Edit my profile</a>
  <dl>
    <dt ng-repeat-start="r in profile.responses">{{ r.question }}</dt>
    <dd ng-repeat-end>{{ r.text }}</dd>
  </dl>
</div>


<h3>Profile Questions</h3>

<ul class="list-group" ng-controller="ProfileQuestionsCtrl as profileQuestions">
  <li ng-repeat="question in profileQuestions.questions | orderBy:'order'"
      class="list-group-item"
      id="question-{{ question.id }}">
    <label>
      {{ question.question_text }}
    </label>

    <div ng-controller="ProfileAnswerCtrl as answer" ng-init="answer.init(<%= @profile.id %>, question.id)">

      {{answer.id}}

      <form novalidate role="form" name="answerForm" class="row">
        <input type="hidden" name="profile_question_id" value="{{ question.id }}" ng-if="answer.answerModel.id === null">
        <input type="hidden" name="profile_id" value="<%= @profile.id %>" ng-if="answer.answerModel.id === null">
        <input type="hidden" name="id" ng-if="answer.answerModel.id !== null">
        <div class="form-group col-lg-8 col-md-8">
          <input type="text" class="form-control" id="new-answer-description-{{question.id}}" ng-model="answer.answerModel.answer_text" ng-maxlength="255">
        </div>
        <div class="form-group col-lg-8 col-md-8">
          <button class="btn btn-primary" ng-click="answer.save()">Save</button>
          <button class="btn btn-default" ng-click="answer.resetForm()">Cancel</button>
        </div>
      </form>

      <div class="list-group" ng-show="answer.inBrowseMode()">
        <label>
          {{ answer.answer_text }}
        </label>
        <button class="btn btn-link pull-right edit" ng-click="profileAnswer.edit(answer)"><i class="fa fa-pencil"></i></button>
      </div>

    </div>
  </li>
</ul>

<!-- bootstrap Angular app with current participant id -->
<script>
  angular.module('socialNetworking')
          .value('participantId', <%= current_participant.id %>)
          .value('profileId', <%= @profile.id %>)
          .value('ProfileQuestions', <%= @profile_questions.to_json.html_safe %>);
</script>
